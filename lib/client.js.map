{"version":3,"sources":["../src/client.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;AAEA;;AACA;;;;;;AACA,MAAM,QAAQ,oBAAU,qBAAV,CAAd;;;;;AAMO,MAAM,UAAN,CAAiB;AACpB,kBAAc;AACV,cAAM,mBAAN;AACH;;;;;;AAOK,SAAN,CAAY,IAAZ,EAAkB,IAAlB,EAAwB;AAAA;;AAAA;AACpB,kBAAM,mBAAN;AACA,kBAAK,SAAL,GAAiB,gBAAO,OAAP,CAAe,IAAf,EAAqB,IAArB,CAAjB;AACA,kBAAM,EAAC,WAAW,MAAK,SAAjB,EAAN;AACA,kBAAK,OAAL,GAAe,MAAM,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAoB;;AAEjD,sBAAK,SAAL,CAAe,gBAAf,CAAgC,UAAC,GAAD,EAAM,IAAN,EAAc;AAC1C,0BAAM,EAAC,KAAK,GAAN,EAAW,MAAM,IAAjB,EAAN;AACA,wBAAI,GAAJ,EAAS;AACL,+BAAO,OAAO,GAAP,CAAP;AACH;AACD,wBAAG,CAAC,IAAJ,EAAS;AACL,+BAAO,OAAO,IAAI,KAAJ,CAAU,iCAAV,CAAP,CAAP;AACH;AACD,2BAAO,QAAQ,IAAR,CAAP;AACH,iBATD;AAUH,aAZoB,CAArB;AAaA,kBAAK,OAAL,CAAa,IAAb,CAAkB,EAAlB,CAAqB,OAArB,EAA8B,YAAI,CAEjC,CAFD;AAjBoB;AAoBvB;;AAEK,QAAN,GAAa;AAAA;;AAAA;AACT,kBAAM,kBAAN;AACA,mBAAK,OAAL,CAAa,IAAb,CAAkB,KAAlB;AAFS;AAGZ;;;;;;;;AAQK,QAAN,CAAW,MAAX,EAA4B;AAAA;;AAAA,0CAAN,IAAM;AAAN,gBAAM;AAAA;;AAAA;AACxB,kBAAM,EAAC,OAAO,iBAAR,EAA2B,QAAQ,MAAnC,EAA2C,MAAM,IAAjD,EAAN;AACA,mBAAO,MAAM,IAAI,OAAJ,CAAY,UAAC,OAAD,EAAU,MAAV,EAAoB;AACzC,uBAAK,OAAL,CAAa,IAAb,CAAkB,MAAlB,EAA0B,IAA1B,EAAgC,UAAC,GAAD,EAAM,MAAN,EAAgB;AAC5C,wBAAI,GAAJ,EAAS;AACL,4BAAG,EAAE,eAAe,KAAjB,CAAH,EAA2B;AACvB,kCAAM,IAAI,KAAJ,CAAU,GAAV,CAAN;AACH;AACD,+BAAO,OAAO,GAAP,CAAP;AACH;AACD,2BAAO,QAAQ,MAAR,CAAP;AACH,iBARD;AASH,aAVY,CAAb;AAFwB;AAc3B;AAzDmB;QAAX,U,GAAA,U","file":"client.js","sourcesContent":["'use strict';\n\nimport {Client} from 'json-rpc2';\nimport Debug from 'debug';\nconst debug = new Debug('ws-telegraph:client');\n\n\n/**\n * WsTgClient for Telegraph-server\n */\nexport class WsTgClient {\n    constructor() {\n        debug('try create client');\n    }\n\n    /**\n     * @param {string} host\n     * @param {number} port\n\n     */\n    async start(host, port) {\n        debug('Client call start');\n        this.apiClient = Client.$create(port, host);\n        debug({apiClient: this.apiClient});\n        this.apiConn = await new Promise((resolve, reject)=> {\n            \n            this.apiClient.connectWebsocket((err, conn)=> {\n                debug({err: err, conn: conn});\n                if (err) {\n                    return reject(err);\n                }\n                if(!conn){\n                    return reject(new Error('Client connection don\\'t opened'));\n                }\n                return resolve(conn);\n            });\n        });\n        this.apiConn.conn.on('error', ()=>{\n            \n        });\n    }\n\n    async stop() {\n        debug('Client call stop');\n        this.apiConn.conn.close();\n    }\n\n    /**\n     * Perform RPC and wait result\n     * @param {string} method - method name\n     * @param {...{}} [args]  arguments for remote procedure\n     * @return {*}\n     */\n    async call(method, ...args) {\n        debug({event: 'WsTgClient call', method: method, args: args});\n        return await new Promise((resolve, reject)=> {\n            this.apiConn.call(method, args, (err, result)=> {\n                if (err) {\n                    if(!(err instanceof Error)){\n                        err = new Error(err);\n                    }\n                    return reject(err);\n                }\n                return resolve(result);\n            });\n        });\n\n    }\n}\n\n"]}